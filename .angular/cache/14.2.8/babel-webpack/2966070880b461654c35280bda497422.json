{"ast":null,"code":"\"use strict\";\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [https://neo4j.com]\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar neo4j_driver_core_1 = require(\"neo4j-driver-core\"); // eslint-disable-next-line no-unused-vars\n\n\nvar rxjs_1 = require(\"rxjs\");\n\nvar operators_1 = require(\"rxjs/operators\");\n\nvar // eslint-disable-next-line no-unused-vars\nLogger = neo4j_driver_core_1.internal.logger.Logger;\nvar SERVICE_UNAVAILABLE = neo4j_driver_core_1.error.SERVICE_UNAVAILABLE;\nvar DEFAULT_MAX_RETRY_TIME_MS = 30 * 1000; // 30 seconds\n\nvar DEFAULT_INITIAL_RETRY_DELAY_MS = 1000; // 1 seconds\n\nvar DEFAULT_RETRY_DELAY_MULTIPLIER = 2.0;\nvar DEFAULT_RETRY_DELAY_JITTER_FACTOR = 0.2;\n\nvar RxRetryLogic =\n/** @class */\nfunction () {\n  /**\n   *\n   * @param {Object} args\n   * @param {Logger} args.logger\n   */\n  function RxRetryLogic(_a) {\n    var _b = _a === void 0 ? {} : _a,\n        _c = _b.maxRetryTimeout,\n        maxRetryTimeout = _c === void 0 ? DEFAULT_MAX_RETRY_TIME_MS : _c,\n        _d = _b.initialDelay,\n        initialDelay = _d === void 0 ? DEFAULT_INITIAL_RETRY_DELAY_MS : _d,\n        _e = _b.delayMultiplier,\n        delayMultiplier = _e === void 0 ? DEFAULT_RETRY_DELAY_MULTIPLIER : _e,\n        _f = _b.delayJitter,\n        delayJitter = _f === void 0 ? DEFAULT_RETRY_DELAY_JITTER_FACTOR : _f,\n        _g = _b.logger,\n        logger = _g === void 0 ? null : _g;\n\n    this._maxRetryTimeout = valueOrDefault(maxRetryTimeout, DEFAULT_MAX_RETRY_TIME_MS);\n    this._initialDelay = valueOrDefault(initialDelay, DEFAULT_INITIAL_RETRY_DELAY_MS);\n    this._delayMultiplier = valueOrDefault(delayMultiplier, DEFAULT_RETRY_DELAY_MULTIPLIER);\n    this._delayJitter = valueOrDefault(delayJitter, DEFAULT_RETRY_DELAY_JITTER_FACTOR);\n    this._logger = logger;\n  }\n  /**\n   *\n   * @param {Observable<Any>} work\n   */\n\n\n  RxRetryLogic.prototype.retry = function (work) {\n    var _this = this;\n\n    return work.pipe((0, operators_1.retryWhen)(function (failedWork) {\n      var handledExceptions = [];\n      var startTime = Date.now();\n      var retryCount = 1;\n      var delayDuration = _this._initialDelay;\n      return failedWork.pipe((0, operators_1.mergeMap)(function (err) {\n        if (!(0, neo4j_driver_core_1.isRetriableError)(err)) {\n          return (0, rxjs_1.throwError)(function () {\n            return err;\n          });\n        }\n\n        handledExceptions.push(err);\n\n        if (retryCount >= 2 && Date.now() - startTime >= _this._maxRetryTimeout) {\n          var error_1 = (0, neo4j_driver_core_1.newError)(\"Failed after retried for \".concat(retryCount, \" times in \").concat(_this._maxRetryTimeout, \" ms. Make sure that your database is online and retry again.\"), SERVICE_UNAVAILABLE);\n          error_1.seenErrors = handledExceptions;\n          return (0, rxjs_1.throwError)(function () {\n            return error_1;\n          });\n        }\n\n        var nextDelayDuration = _this._computeNextDelay(delayDuration);\n\n        delayDuration = delayDuration * _this._delayMultiplier;\n        retryCount++;\n\n        if (_this._logger) {\n          _this._logger.warn(\"Transaction failed and will be retried in \".concat(nextDelayDuration));\n        }\n\n        return (0, rxjs_1.of)(1).pipe((0, operators_1.delay)(nextDelayDuration));\n      }));\n    }));\n  };\n\n  RxRetryLogic.prototype._computeNextDelay = function (delay) {\n    var jitter = delay * this._delayJitter;\n    return delay - jitter + 2 * jitter * Math.random();\n  };\n\n  return RxRetryLogic;\n}();\n\nexports.default = RxRetryLogic;\n\nfunction valueOrDefault(value, defaultValue) {\n  if (value || value === 0) {\n    return value;\n  }\n\n  return defaultValue;\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","neo4j_driver_core_1","require","rxjs_1","operators_1","Logger","internal","logger","SERVICE_UNAVAILABLE","error","DEFAULT_MAX_RETRY_TIME_MS","DEFAULT_INITIAL_RETRY_DELAY_MS","DEFAULT_RETRY_DELAY_MULTIPLIER","DEFAULT_RETRY_DELAY_JITTER_FACTOR","RxRetryLogic","_a","_b","_c","maxRetryTimeout","_d","initialDelay","_e","delayMultiplier","_f","delayJitter","_g","_maxRetryTimeout","valueOrDefault","_initialDelay","_delayMultiplier","_delayJitter","_logger","prototype","retry","work","_this","pipe","retryWhen","failedWork","handledExceptions","startTime","Date","now","retryCount","delayDuration","mergeMap","err","isRetriableError","throwError","push","error_1","newError","concat","seenErrors","nextDelayDuration","_computeNextDelay","warn","of","delay","jitter","Math","random","default","defaultValue"],"sources":["C:/projects/levelUp_v1/Level-Up-FN/Level-Up-Fronten-master/node_modules/neo4j-driver/lib/internal/retry-logic-rx.js"],"sourcesContent":["\"use strict\";\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [https://neo4j.com]\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar neo4j_driver_core_1 = require(\"neo4j-driver-core\");\n// eslint-disable-next-line no-unused-vars\nvar rxjs_1 = require(\"rxjs\");\nvar operators_1 = require(\"rxjs/operators\");\nvar \n// eslint-disable-next-line no-unused-vars\nLogger = neo4j_driver_core_1.internal.logger.Logger;\nvar SERVICE_UNAVAILABLE = neo4j_driver_core_1.error.SERVICE_UNAVAILABLE;\nvar DEFAULT_MAX_RETRY_TIME_MS = 30 * 1000; // 30 seconds\nvar DEFAULT_INITIAL_RETRY_DELAY_MS = 1000; // 1 seconds\nvar DEFAULT_RETRY_DELAY_MULTIPLIER = 2.0;\nvar DEFAULT_RETRY_DELAY_JITTER_FACTOR = 0.2;\nvar RxRetryLogic = /** @class */ (function () {\n    /**\n     *\n     * @param {Object} args\n     * @param {Logger} args.logger\n     */\n    function RxRetryLogic(_a) {\n        var _b = _a === void 0 ? {} : _a, _c = _b.maxRetryTimeout, maxRetryTimeout = _c === void 0 ? DEFAULT_MAX_RETRY_TIME_MS : _c, _d = _b.initialDelay, initialDelay = _d === void 0 ? DEFAULT_INITIAL_RETRY_DELAY_MS : _d, _e = _b.delayMultiplier, delayMultiplier = _e === void 0 ? DEFAULT_RETRY_DELAY_MULTIPLIER : _e, _f = _b.delayJitter, delayJitter = _f === void 0 ? DEFAULT_RETRY_DELAY_JITTER_FACTOR : _f, _g = _b.logger, logger = _g === void 0 ? null : _g;\n        this._maxRetryTimeout = valueOrDefault(maxRetryTimeout, DEFAULT_MAX_RETRY_TIME_MS);\n        this._initialDelay = valueOrDefault(initialDelay, DEFAULT_INITIAL_RETRY_DELAY_MS);\n        this._delayMultiplier = valueOrDefault(delayMultiplier, DEFAULT_RETRY_DELAY_MULTIPLIER);\n        this._delayJitter = valueOrDefault(delayJitter, DEFAULT_RETRY_DELAY_JITTER_FACTOR);\n        this._logger = logger;\n    }\n    /**\n     *\n     * @param {Observable<Any>} work\n     */\n    RxRetryLogic.prototype.retry = function (work) {\n        var _this = this;\n        return work.pipe((0, operators_1.retryWhen)(function (failedWork) {\n            var handledExceptions = [];\n            var startTime = Date.now();\n            var retryCount = 1;\n            var delayDuration = _this._initialDelay;\n            return failedWork.pipe((0, operators_1.mergeMap)(function (err) {\n                if (!(0, neo4j_driver_core_1.isRetriableError)(err)) {\n                    return (0, rxjs_1.throwError)(function () { return err; });\n                }\n                handledExceptions.push(err);\n                if (retryCount >= 2 &&\n                    Date.now() - startTime >= _this._maxRetryTimeout) {\n                    var error_1 = (0, neo4j_driver_core_1.newError)(\"Failed after retried for \".concat(retryCount, \" times in \").concat(_this._maxRetryTimeout, \" ms. Make sure that your database is online and retry again.\"), SERVICE_UNAVAILABLE);\n                    error_1.seenErrors = handledExceptions;\n                    return (0, rxjs_1.throwError)(function () { return error_1; });\n                }\n                var nextDelayDuration = _this._computeNextDelay(delayDuration);\n                delayDuration = delayDuration * _this._delayMultiplier;\n                retryCount++;\n                if (_this._logger) {\n                    _this._logger.warn(\"Transaction failed and will be retried in \".concat(nextDelayDuration));\n                }\n                return (0, rxjs_1.of)(1).pipe((0, operators_1.delay)(nextDelayDuration));\n            }));\n        }));\n    };\n    RxRetryLogic.prototype._computeNextDelay = function (delay) {\n        var jitter = delay * this._delayJitter;\n        return delay - jitter + 2 * jitter * Math.random();\n    };\n    return RxRetryLogic;\n}());\nexports.default = RxRetryLogic;\nfunction valueOrDefault(value, defaultValue) {\n    if (value || value === 0) {\n        return value;\n    }\n    return defaultValue;\n}"],"mappings":"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"},"metadata":{},"sourceType":"script"}