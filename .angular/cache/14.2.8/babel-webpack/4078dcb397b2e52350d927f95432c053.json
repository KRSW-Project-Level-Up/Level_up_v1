{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (g && (g = 0, op[0] && (_ = 0)), _) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TransactionExecutor = void 0;\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [https://neo4j.com]\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/promise-function-async */\n\nvar error_1 = require(\"../error\");\n\nvar constants_1 = require(\"./constants\");\n\nvar DEFAULT_MAX_RETRY_TIME_MS = 30 * 1000; // 30 seconds\n\nvar DEFAULT_INITIAL_RETRY_DELAY_MS = 1000; // 1 seconds\n\nvar DEFAULT_RETRY_DELAY_MULTIPLIER = 2.0;\nvar DEFAULT_RETRY_DELAY_JITTER_FACTOR = 0.2;\n\nfunction setTimeoutWrapper(callback, ms) {\n  var args = [];\n\n  for (var _i = 2; _i < arguments.length; _i++) {\n    args[_i - 2] = arguments[_i];\n  }\n\n  return setTimeout.apply(void 0, __spreadArray([callback, ms], __read(args), false));\n}\n\nfunction clearTimeoutWrapper(timeoutId) {\n  return clearTimeout(timeoutId);\n}\n\nvar TransactionExecutor =\n/** @class */\nfunction () {\n  function TransactionExecutor(maxRetryTimeMs, initialRetryDelayMs, multiplier, jitterFactor, dependencies) {\n    if (dependencies === void 0) {\n      dependencies = {\n        setTimeout: setTimeoutWrapper,\n        clearTimeout: clearTimeoutWrapper\n      };\n    }\n\n    this._maxRetryTimeMs = _valueOrDefault(maxRetryTimeMs, DEFAULT_MAX_RETRY_TIME_MS);\n    this._initialRetryDelayMs = _valueOrDefault(initialRetryDelayMs, DEFAULT_INITIAL_RETRY_DELAY_MS);\n    this._multiplier = _valueOrDefault(multiplier, DEFAULT_RETRY_DELAY_MULTIPLIER);\n    this._jitterFactor = _valueOrDefault(jitterFactor, DEFAULT_RETRY_DELAY_JITTER_FACTOR);\n    this._setTimeout = dependencies.setTimeout;\n    this._clearTimeout = dependencies.clearTimeout;\n    this._inFlightTimeoutIds = [];\n    this.pipelineBegin = false;\n    this.telemetryApi = constants_1.TELEMETRY_APIS.MANAGED_TRANSACTION;\n\n    this._verifyAfterConstruction();\n  }\n\n  TransactionExecutor.prototype.execute = function (transactionCreator, transactionWork, transactionWrapper) {\n    var _this = this;\n\n    var context = {\n      apiTransactionConfig: {\n        api: this.telemetryApi,\n        onTelemetrySuccess: function () {\n          context.apiTransactionConfig = undefined;\n        }\n      }\n    };\n    return new Promise(function (resolve, reject) {\n      _this._executeTransactionInsidePromise(transactionCreator, transactionWork, resolve, reject, transactionWrapper, context).catch(reject);\n    }).catch(function (error) {\n      var retryStartTimeMs = Date.now();\n      var retryDelayMs = _this._initialRetryDelayMs;\n      return _this._retryTransactionPromise(transactionCreator, transactionWork, error, retryStartTimeMs, retryDelayMs, transactionWrapper, context);\n    });\n  };\n\n  TransactionExecutor.prototype.close = function () {\n    var _this = this; // cancel all existing timeouts to prevent further retries\n\n\n    this._inFlightTimeoutIds.forEach(function (timeoutId) {\n      return _this._clearTimeout(timeoutId);\n    });\n\n    this._inFlightTimeoutIds = [];\n  };\n\n  TransactionExecutor.prototype._retryTransactionPromise = function (transactionCreator, transactionWork, error, retryStartTime, retryDelayMs, transactionWrapper, executionContext) {\n    var _this = this;\n\n    var elapsedTimeMs = Date.now() - retryStartTime;\n\n    if (elapsedTimeMs > this._maxRetryTimeMs || !(0, error_1.isRetriableError)(error)) {\n      return Promise.reject(error);\n    }\n\n    return new Promise(function (resolve, reject) {\n      var nextRetryTime = _this._computeDelayWithJitter(retryDelayMs);\n\n      var timeoutId = _this._setTimeout(function () {\n        // filter out this timeoutId when time has come and function is being executed\n        _this._inFlightTimeoutIds = _this._inFlightTimeoutIds.filter(function (id) {\n          return id !== timeoutId;\n        });\n\n        _this._executeTransactionInsidePromise(transactionCreator, transactionWork, resolve, reject, transactionWrapper, executionContext).catch(reject);\n      }, nextRetryTime); // add newly created timeoutId to the list of all in-flight timeouts\n\n\n      _this._inFlightTimeoutIds.push(timeoutId);\n    }).catch(function (error) {\n      var nextRetryDelayMs = retryDelayMs * _this._multiplier;\n      return _this._retryTransactionPromise(transactionCreator, transactionWork, error, retryStartTime, nextRetryDelayMs, transactionWrapper, executionContext);\n    });\n  };\n\n  TransactionExecutor.prototype._executeTransactionInsidePromise = function (transactionCreator, transactionWork, resolve, reject, transactionWrapper, executionContext) {\n    return __awaiter(this, void 0, void 0, function () {\n      var tx, txPromise, _a, error_2, wrap, wrappedTx, resultPromise;\n\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _b.trys.push([0, 4,, 5]);\n\n            txPromise = transactionCreator((executionContext === null || executionContext === void 0 ? void 0 : executionContext.apiTransactionConfig) != null ? __assign({}, executionContext === null || executionContext === void 0 ? void 0 : executionContext.apiTransactionConfig) : undefined);\n            if (!this.pipelineBegin) return [3\n            /*break*/\n            , 1];\n            _a = txPromise;\n            return [3\n            /*break*/\n            , 3];\n\n          case 1:\n            return [4\n            /*yield*/\n            , txPromise];\n\n          case 2:\n            _a = _b.sent();\n            _b.label = 3;\n\n          case 3:\n            tx = _a;\n            return [3\n            /*break*/\n            , 5];\n\n          case 4:\n            error_2 = _b.sent(); // failed to create a transaction\n\n            reject(error_2);\n            return [2\n            /*return*/\n            ];\n\n          case 5:\n            wrap = transactionWrapper !== null && transactionWrapper !== void 0 ? transactionWrapper : function (tx) {\n              return tx;\n            };\n            wrappedTx = wrap(tx);\n            resultPromise = this._safeExecuteTransactionWork(wrappedTx, transactionWork);\n            resultPromise.then(function (result) {\n              return _this._handleTransactionWorkSuccess(result, tx, resolve, reject);\n            }).catch(function (error) {\n              return _this._handleTransactionWorkFailure(error, tx, reject);\n            });\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  TransactionExecutor.prototype._safeExecuteTransactionWork = function (tx, transactionWork) {\n    try {\n      var result = transactionWork(tx); // user defined callback is supposed to return a promise, but it might not; so to protect against an\n      // incorrect API usage we wrap the returned value with a resolved promise; this is effectively a\n      // validation step without type checks\n\n      return Promise.resolve(result);\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  };\n\n  TransactionExecutor.prototype._handleTransactionWorkSuccess = function (result, tx, resolve, reject) {\n    if (tx.isOpen()) {\n      // transaction work returned resolved promise and transaction has not been committed/rolled back\n      // try to commit the transaction\n      tx.commit().then(function () {\n        // transaction was committed, return result to the user\n        resolve(result);\n      }).catch(function (error) {\n        // transaction failed to commit, propagate the failure\n        reject(error);\n      });\n    } else {\n      // transaction work returned resolved promise and transaction is already committed/rolled back\n      // return the result returned by given transaction work\n      resolve(result);\n    }\n  };\n\n  TransactionExecutor.prototype._handleTransactionWorkFailure = function (error, tx, reject) {\n    if (tx.isOpen()) {\n      // transaction work failed and the transaction is still open, roll it back and propagate the failure\n      tx.rollback().catch(function (ignore) {// ignore the rollback error\n      }).then(function () {\n        return reject(error);\n      }) // propagate the original error we got from the transaction work\n      .catch(reject);\n    } else {\n      // transaction is already rolled back, propagate the error\n      reject(error);\n    }\n  };\n\n  TransactionExecutor.prototype._computeDelayWithJitter = function (delayMs) {\n    var jitter = delayMs * this._jitterFactor;\n    var min = delayMs - jitter;\n    var max = delayMs + jitter;\n    return Math.random() * (max - min) + min;\n  };\n\n  TransactionExecutor.prototype._verifyAfterConstruction = function () {\n    if (this._maxRetryTimeMs < 0) {\n      throw (0, error_1.newError)('Max retry time should be >= 0: ' + this._maxRetryTimeMs.toString());\n    }\n\n    if (this._initialRetryDelayMs < 0) {\n      throw (0, error_1.newError)('Initial retry delay should >= 0: ' + this._initialRetryDelayMs.toString());\n    }\n\n    if (this._multiplier < 1.0) {\n      throw (0, error_1.newError)('Multiplier should be >= 1.0: ' + this._multiplier.toString());\n    }\n\n    if (this._jitterFactor < 0 || this._jitterFactor > 1) {\n      throw (0, error_1.newError)('Jitter factor should be in [0.0, 1.0]: ' + this._jitterFactor.toFixed());\n    }\n  };\n\n  return TransactionExecutor;\n}();\n\nexports.TransactionExecutor = TransactionExecutor;\n\nfunction _valueOrDefault(value, defaultValue) {\n  if (value != null) {\n    return value;\n  }\n\n  return defaultValue;\n}","map":{"version":3,"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","__read","o","m","r","ar","error","__spreadArray","to","from","pack","l","Array","slice","concat","defineProperty","exports","TransactionExecutor","error_1","require","constants_1","DEFAULT_MAX_RETRY_TIME_MS","DEFAULT_INITIAL_RETRY_DELAY_MS","DEFAULT_RETRY_DELAY_MULTIPLIER","DEFAULT_RETRY_DELAY_JITTER_FACTOR","setTimeoutWrapper","callback","ms","args","_i","setTimeout","clearTimeoutWrapper","timeoutId","clearTimeout","maxRetryTimeMs","initialRetryDelayMs","multiplier","jitterFactor","dependencies","_maxRetryTimeMs","_valueOrDefault","_initialRetryDelayMs","_multiplier","_jitterFactor","_setTimeout","_clearTimeout","_inFlightTimeoutIds","pipelineBegin","telemetryApi","TELEMETRY_APIS","MANAGED_TRANSACTION","_verifyAfterConstruction","execute","transactionCreator","transactionWork","transactionWrapper","_this","context","apiTransactionConfig","api","onTelemetrySuccess","undefined","_executeTransactionInsidePromise","catch","retryStartTimeMs","Date","now","retryDelayMs","_retryTransactionPromise","close","forEach","retryStartTime","executionContext","elapsedTimeMs","isRetriableError","nextRetryTime","_computeDelayWithJitter","filter","id","nextRetryDelayMs","tx","txPromise","_a","error_2","wrap","wrappedTx","resultPromise","_b","_safeExecuteTransactionWork","_handleTransactionWorkSuccess","_handleTransactionWorkFailure","isOpen","commit","rollback","ignore","delayMs","jitter","min","max","Math","random","newError","toString","toFixed","defaultValue"],"sources":["C:/projects/levelUp_v1/Level-Up-FN/Level-Up-Fronten-master/node_modules/neo4j-driver-core/lib/internal/transaction-executor.js"],"sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TransactionExecutor = void 0;\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [https://neo4j.com]\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* eslint-disable @typescript-eslint/promise-function-async */\nvar error_1 = require(\"../error\");\nvar constants_1 = require(\"./constants\");\nvar DEFAULT_MAX_RETRY_TIME_MS = 30 * 1000; // 30 seconds\nvar DEFAULT_INITIAL_RETRY_DELAY_MS = 1000; // 1 seconds\nvar DEFAULT_RETRY_DELAY_MULTIPLIER = 2.0;\nvar DEFAULT_RETRY_DELAY_JITTER_FACTOR = 0.2;\nfunction setTimeoutWrapper(callback, ms) {\n    var args = [];\n    for (var _i = 2; _i < arguments.length; _i++) {\n        args[_i - 2] = arguments[_i];\n    }\n    return setTimeout.apply(void 0, __spreadArray([callback, ms], __read(args), false));\n}\nfunction clearTimeoutWrapper(timeoutId) {\n    return clearTimeout(timeoutId);\n}\nvar TransactionExecutor = /** @class */ (function () {\n    function TransactionExecutor(maxRetryTimeMs, initialRetryDelayMs, multiplier, jitterFactor, dependencies) {\n        if (dependencies === void 0) { dependencies = {\n            setTimeout: setTimeoutWrapper,\n            clearTimeout: clearTimeoutWrapper\n        }; }\n        this._maxRetryTimeMs = _valueOrDefault(maxRetryTimeMs, DEFAULT_MAX_RETRY_TIME_MS);\n        this._initialRetryDelayMs = _valueOrDefault(initialRetryDelayMs, DEFAULT_INITIAL_RETRY_DELAY_MS);\n        this._multiplier = _valueOrDefault(multiplier, DEFAULT_RETRY_DELAY_MULTIPLIER);\n        this._jitterFactor = _valueOrDefault(jitterFactor, DEFAULT_RETRY_DELAY_JITTER_FACTOR);\n        this._setTimeout = dependencies.setTimeout;\n        this._clearTimeout = dependencies.clearTimeout;\n        this._inFlightTimeoutIds = [];\n        this.pipelineBegin = false;\n        this.telemetryApi = constants_1.TELEMETRY_APIS.MANAGED_TRANSACTION;\n        this._verifyAfterConstruction();\n    }\n    TransactionExecutor.prototype.execute = function (transactionCreator, transactionWork, transactionWrapper) {\n        var _this = this;\n        var context = {\n            apiTransactionConfig: {\n                api: this.telemetryApi,\n                onTelemetrySuccess: function () {\n                    context.apiTransactionConfig = undefined;\n                }\n            }\n        };\n        return new Promise(function (resolve, reject) {\n            _this._executeTransactionInsidePromise(transactionCreator, transactionWork, resolve, reject, transactionWrapper, context).catch(reject);\n        }).catch(function (error) {\n            var retryStartTimeMs = Date.now();\n            var retryDelayMs = _this._initialRetryDelayMs;\n            return _this._retryTransactionPromise(transactionCreator, transactionWork, error, retryStartTimeMs, retryDelayMs, transactionWrapper, context);\n        });\n    };\n    TransactionExecutor.prototype.close = function () {\n        var _this = this;\n        // cancel all existing timeouts to prevent further retries\n        this._inFlightTimeoutIds.forEach(function (timeoutId) { return _this._clearTimeout(timeoutId); });\n        this._inFlightTimeoutIds = [];\n    };\n    TransactionExecutor.prototype._retryTransactionPromise = function (transactionCreator, transactionWork, error, retryStartTime, retryDelayMs, transactionWrapper, executionContext) {\n        var _this = this;\n        var elapsedTimeMs = Date.now() - retryStartTime;\n        if (elapsedTimeMs > this._maxRetryTimeMs || !(0, error_1.isRetriableError)(error)) {\n            return Promise.reject(error);\n        }\n        return new Promise(function (resolve, reject) {\n            var nextRetryTime = _this._computeDelayWithJitter(retryDelayMs);\n            var timeoutId = _this._setTimeout(function () {\n                // filter out this timeoutId when time has come and function is being executed\n                _this._inFlightTimeoutIds = _this._inFlightTimeoutIds.filter(function (id) { return id !== timeoutId; });\n                _this._executeTransactionInsidePromise(transactionCreator, transactionWork, resolve, reject, transactionWrapper, executionContext).catch(reject);\n            }, nextRetryTime);\n            // add newly created timeoutId to the list of all in-flight timeouts\n            _this._inFlightTimeoutIds.push(timeoutId);\n        }).catch(function (error) {\n            var nextRetryDelayMs = retryDelayMs * _this._multiplier;\n            return _this._retryTransactionPromise(transactionCreator, transactionWork, error, retryStartTime, nextRetryDelayMs, transactionWrapper, executionContext);\n        });\n    };\n    TransactionExecutor.prototype._executeTransactionInsidePromise = function (transactionCreator, transactionWork, resolve, reject, transactionWrapper, executionContext) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tx, txPromise, _a, error_2, wrap, wrappedTx, resultPromise;\n            var _this = this;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _b.trys.push([0, 4, , 5]);\n                        txPromise = transactionCreator((executionContext === null || executionContext === void 0 ? void 0 : executionContext.apiTransactionConfig) != null\n                            ? __assign({}, executionContext === null || executionContext === void 0 ? void 0 : executionContext.apiTransactionConfig) : undefined);\n                        if (!this.pipelineBegin) return [3 /*break*/, 1];\n                        _a = txPromise;\n                        return [3 /*break*/, 3];\n                    case 1: return [4 /*yield*/, txPromise];\n                    case 2:\n                        _a = _b.sent();\n                        _b.label = 3;\n                    case 3:\n                        tx = _a;\n                        return [3 /*break*/, 5];\n                    case 4:\n                        error_2 = _b.sent();\n                        // failed to create a transaction\n                        reject(error_2);\n                        return [2 /*return*/];\n                    case 5:\n                        wrap = transactionWrapper !== null && transactionWrapper !== void 0 ? transactionWrapper : (function (tx) { return tx; });\n                        wrappedTx = wrap(tx);\n                        resultPromise = this._safeExecuteTransactionWork(wrappedTx, transactionWork);\n                        resultPromise\n                            .then(function (result) {\n                            return _this._handleTransactionWorkSuccess(result, tx, resolve, reject);\n                        })\n                            .catch(function (error) { return _this._handleTransactionWorkFailure(error, tx, reject); });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    TransactionExecutor.prototype._safeExecuteTransactionWork = function (tx, transactionWork) {\n        try {\n            var result = transactionWork(tx);\n            // user defined callback is supposed to return a promise, but it might not; so to protect against an\n            // incorrect API usage we wrap the returned value with a resolved promise; this is effectively a\n            // validation step without type checks\n            return Promise.resolve(result);\n        }\n        catch (error) {\n            return Promise.reject(error);\n        }\n    };\n    TransactionExecutor.prototype._handleTransactionWorkSuccess = function (result, tx, resolve, reject) {\n        if (tx.isOpen()) {\n            // transaction work returned resolved promise and transaction has not been committed/rolled back\n            // try to commit the transaction\n            tx.commit()\n                .then(function () {\n                // transaction was committed, return result to the user\n                resolve(result);\n            })\n                .catch(function (error) {\n                // transaction failed to commit, propagate the failure\n                reject(error);\n            });\n        }\n        else {\n            // transaction work returned resolved promise and transaction is already committed/rolled back\n            // return the result returned by given transaction work\n            resolve(result);\n        }\n    };\n    TransactionExecutor.prototype._handleTransactionWorkFailure = function (error, tx, reject) {\n        if (tx.isOpen()) {\n            // transaction work failed and the transaction is still open, roll it back and propagate the failure\n            tx.rollback()\n                .catch(function (ignore) {\n                // ignore the rollback error\n            })\n                .then(function () { return reject(error); }) // propagate the original error we got from the transaction work\n                .catch(reject);\n        }\n        else {\n            // transaction is already rolled back, propagate the error\n            reject(error);\n        }\n    };\n    TransactionExecutor.prototype._computeDelayWithJitter = function (delayMs) {\n        var jitter = delayMs * this._jitterFactor;\n        var min = delayMs - jitter;\n        var max = delayMs + jitter;\n        return Math.random() * (max - min) + min;\n    };\n    TransactionExecutor.prototype._verifyAfterConstruction = function () {\n        if (this._maxRetryTimeMs < 0) {\n            throw (0, error_1.newError)('Max retry time should be >= 0: ' + this._maxRetryTimeMs.toString());\n        }\n        if (this._initialRetryDelayMs < 0) {\n            throw (0, error_1.newError)('Initial retry delay should >= 0: ' + this._initialRetryDelayMs.toString());\n        }\n        if (this._multiplier < 1.0) {\n            throw (0, error_1.newError)('Multiplier should be >= 1.0: ' + this._multiplier.toString());\n        }\n        if (this._jitterFactor < 0 || this._jitterFactor > 1) {\n            throw (0, error_1.newError)('Jitter factor should be in [0.0, 1.0]: ' + this._jitterFactor.toFixed());\n        }\n    };\n    return TransactionExecutor;\n}());\nexports.TransactionExecutor = TransactionExecutor;\nfunction _valueOrDefault(value, defaultValue) {\n    if (value != null) {\n        return value;\n    }\n    return defaultValue;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}