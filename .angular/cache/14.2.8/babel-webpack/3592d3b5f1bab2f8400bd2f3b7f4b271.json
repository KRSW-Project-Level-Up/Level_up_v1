{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [https://neo4j.com]\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar bolt_protocol_util_1 = require(\"./bolt-protocol-util\"); // eslint-disable-next-line no-unused-vars\n\n\nvar channel_1 = require(\"../channel\");\n\nvar packstream_1 = require(\"../packstream\");\n\nvar request_message_1 = __importStar(require(\"./request-message\"));\n\nvar stream_observers_1 = require(\"./stream-observers\");\n\nvar neo4j_driver_core_1 = require(\"neo4j-driver-core\");\n\nvar bolt_protocol_v1_transformer_1 = __importDefault(require(\"./bolt-protocol-v1.transformer\"));\n\nvar transformer_1 = __importDefault(require(\"./transformer\"));\n\nvar Bookmarks = neo4j_driver_core_1.internal.bookmarks.Bookmarks,\n    _a = neo4j_driver_core_1.internal.constants,\n    ACCESS_MODE_WRITE = _a.ACCESS_MODE_WRITE,\n    BOLT_PROTOCOL_V1 = _a.BOLT_PROTOCOL_V1,\n    Logger = neo4j_driver_core_1.internal.logger.Logger,\n    TxConfig = neo4j_driver_core_1.internal.txConfig.TxConfig;\n\nvar BoltProtocol =\n/** @class */\nfunction () {\n  /**\n   * @callback CreateResponseHandler Creates the response handler\n   * @param {BoltProtocol} protocol The bolt protocol\n   * @returns {ResponseHandler} The response handler\n   */\n\n  /**\n   * @callback OnProtocolError Handles protocol error\n   * @param {string} error The description\n   */\n\n  /**\n   * @constructor\n   * @param {Object} server the server informatio.\n   * @param {Chunker} chunker the chunker.\n   * @param {Object} packstreamConfig Packstream configuration\n   * @param {boolean} packstreamConfig.disableLosslessIntegers if this connection should convert all received integers to native JS numbers.\n   * @param {boolean} packstreamConfig.useBigInt if this connection should convert all received integers to native BigInt numbers.\n   * @param {CreateResponseHandler} createResponseHandler Function which creates the response handler\n   * @param {Logger} log the logger\n   * @param {OnProtocolError} onProtocolError handles protocol errors\n   */\n  function BoltProtocol(server, chunker, _a, createResponseHandler, log, onProtocolError) {\n    var _b = _a === void 0 ? {} : _a,\n        disableLosslessIntegers = _b.disableLosslessIntegers,\n        useBigInt = _b.useBigInt;\n\n    if (createResponseHandler === void 0) {\n      createResponseHandler = function () {\n        return null;\n      };\n    }\n\n    this._server = server || {};\n    this._chunker = chunker;\n    this._packer = this._createPacker(chunker);\n    this._unpacker = this._createUnpacker(disableLosslessIntegers, useBigInt);\n    this._responseHandler = createResponseHandler(this);\n    this._log = log;\n    this._onProtocolError = onProtocolError;\n    this._fatalError = null;\n    this._lastMessageSignature = null;\n    this._config = {\n      disableLosslessIntegers: disableLosslessIntegers,\n      useBigInt: useBigInt\n    };\n  }\n\n  Object.defineProperty(BoltProtocol.prototype, \"transformer\", {\n    get: function () {\n      var _this = this;\n\n      if (this._transformer === undefined) {\n        this._transformer = new transformer_1.default(Object.values(bolt_protocol_v1_transformer_1.default).map(function (create) {\n          return create(_this._config, _this._log);\n        }));\n      }\n\n      return this._transformer;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(BoltProtocol.prototype, \"version\", {\n    /**\n     * Returns the numerical version identifier for this protocol\n     */\n    get: function () {\n      return BOLT_PROTOCOL_V1;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(BoltProtocol.prototype, \"supportsReAuth\", {\n    /**\n     * @property {boolean} supportsReAuth Either if the protocol version supports re-auth or not.\n     */\n    get: function () {\n      return false;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(BoltProtocol.prototype, \"initialized\", {\n    /**\n     * @property {boolean} initialized Either if the protocol was initialized or not\n     */\n    get: function () {\n      return !!this._initialized;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(BoltProtocol.prototype, \"authToken\", {\n    /**\n     * @property {object} authToken The token used in the last login\n     */\n    get: function () {\n      return this._authToken;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Get the packer.\n   * @return {Packer} the protocol's packer.\n   */\n\n  BoltProtocol.prototype.packer = function () {\n    return this._packer;\n  };\n  /**\n   * Creates a packable function out of the provided value\n   * @param x the value to pack\n   * @returns Function\n   */\n\n\n  BoltProtocol.prototype.packable = function (x) {\n    return this._packer.packable(x, this.transformer.toStructure);\n  };\n  /**\n   * Get the unpacker.\n   * @return {Unpacker} the protocol's unpacker.\n   */\n\n\n  BoltProtocol.prototype.unpacker = function () {\n    return this._unpacker;\n  };\n  /**\n   * Unpack a buffer\n   * @param {Buffer} buf\n   * @returns {any|null} The unpacked value\n   */\n\n\n  BoltProtocol.prototype.unpack = function (buf) {\n    return this._unpacker.unpack(buf, this.transformer.fromStructure);\n  };\n  /**\n   * Transform metadata received in SUCCESS message before it is passed to the handler.\n   * @param {Object} metadata the received metadata.\n   * @return {Object} transformed metadata.\n   */\n\n\n  BoltProtocol.prototype.transformMetadata = function (metadata) {\n    return metadata;\n  };\n  /**\n   * Perform initialization and authentication of the underlying connection.\n   * @param {Object} param\n   * @param {string} param.userAgent the user agent.\n   * @param {Object} param.authToken the authentication token.\n   * @param {NotificationFilter} param.notificationFilter the notification filter.\n   * @param {function(err: Error)} param.onError the callback to invoke on error.\n   * @param {function()} param.onComplete the callback to invoke on completion.\n   * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n   */\n\n\n  BoltProtocol.prototype.initialize = function (_a) {\n    var _this = this;\n\n    var _b = _a === void 0 ? {} : _a,\n        userAgent = _b.userAgent,\n        boltAgent = _b.boltAgent,\n        authToken = _b.authToken,\n        notificationFilter = _b.notificationFilter,\n        onError = _b.onError,\n        onComplete = _b.onComplete;\n\n    var observer = new stream_observers_1.LoginObserver({\n      onError: function (error) {\n        return _this._onLoginError(error, onError);\n      },\n      onCompleted: function (metadata) {\n        return _this._onLoginCompleted(metadata, onComplete);\n      }\n    }); // passing notification filter on this protocol version throws an error\n\n    (0, bolt_protocol_util_1.assertNotificationFilterIsEmpty)(notificationFilter, this._onProtocolError, observer);\n    this.write(request_message_1.default.init(userAgent, authToken), observer, true);\n    return observer;\n  };\n  /**\n   * Performs logoff of the underlying connection\n   *\n   * @param {Object} param\n   * @param {function(err: Error)} param.onError the callback to invoke on error.\n   * @param {function()} param.onComplete the callback to invoke on completion.\n   * @param {boolean} param.flush whether to flush the buffered messages.\n   *\n   * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n   */\n\n\n  BoltProtocol.prototype.logoff = function (_a) {\n    var _b = _a === void 0 ? {} : _a,\n        onComplete = _b.onComplete,\n        onError = _b.onError,\n        flush = _b.flush;\n\n    var observer = new stream_observers_1.LogoffObserver({\n      onCompleted: onComplete,\n      onError: onError\n    }); // TODO: Verify the Neo4j version in the message\n\n    var error = (0, neo4j_driver_core_1.newError)('Driver is connected to a database that does not support logoff. ' + 'Please upgrade to Neo4j 5.5.0 or later in order to use this functionality.'); // unsupported API was used, consider this a fatal error for the current connection\n\n    this._onProtocolError(error.message);\n\n    observer.onError(error);\n    throw error;\n  };\n  /**\n   * Performs login of the underlying connection\n   *\n   * @param {Object} args\n   * @param {Object} args.authToken the authentication token.\n   * @param {function(err: Error)} args.onError the callback to invoke on error.\n   * @param {function()} args.onComplete the callback to invoke on completion.\n   * @param {boolean} args.flush whether to flush the buffered messages.\n   *\n   * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n   */\n\n\n  BoltProtocol.prototype.logon = function (_a) {\n    var _this = this;\n\n    var _b = _a === void 0 ? {} : _a,\n        authToken = _b.authToken,\n        onComplete = _b.onComplete,\n        onError = _b.onError,\n        flush = _b.flush;\n\n    var observer = new stream_observers_1.LoginObserver({\n      onCompleted: function () {\n        return _this._onLoginCompleted({}, authToken, onComplete);\n      },\n      onError: function (error) {\n        return _this._onLoginError(error, onError);\n      }\n    }); // TODO: Verify the Neo4j version in the message\n\n    var error = (0, neo4j_driver_core_1.newError)('Driver is connected to a database that does not support logon. ' + 'Please upgrade to Neo4j 5.5.0 or later in order to use this functionality.'); // unsupported API was used, consider this a fatal error for the current connection\n\n    this._onProtocolError(error.message);\n\n    observer.onError(error);\n    throw error;\n  };\n  /**\n   * Perform protocol related operations for closing this connection\n   */\n\n\n  BoltProtocol.prototype.prepareToClose = function () {// no need to notify the database in this protocol version\n  };\n  /**\n   * Begin an explicit transaction.\n   * @param {Object} param\n   * @param {Bookmarks} param.bookmarks the bookmarks.\n   * @param {TxConfig} param.txConfig the configuration.\n   * @param {string} param.database the target database name.\n   * @param {string} param.mode the access mode.\n   * @param {string} param.impersonatedUser the impersonated user\n   * @param {NotificationFilter} param.notificationFilter the notification filter.\n   * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n   * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n   * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n   * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n   * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n   */\n\n\n  BoltProtocol.prototype.beginTransaction = function (_a) {\n    var _b = _a === void 0 ? {} : _a,\n        bookmarks = _b.bookmarks,\n        txConfig = _b.txConfig,\n        database = _b.database,\n        mode = _b.mode,\n        impersonatedUser = _b.impersonatedUser,\n        notificationFilter = _b.notificationFilter,\n        beforeError = _b.beforeError,\n        afterError = _b.afterError,\n        beforeComplete = _b.beforeComplete,\n        afterComplete = _b.afterComplete;\n\n    return this.run('BEGIN', bookmarks ? bookmarks.asBeginTransactionParameters() : {}, {\n      bookmarks: bookmarks,\n      txConfig: txConfig,\n      database: database,\n      mode: mode,\n      impersonatedUser: impersonatedUser,\n      notificationFilter: notificationFilter,\n      beforeError: beforeError,\n      afterError: afterError,\n      beforeComplete: beforeComplete,\n      afterComplete: afterComplete,\n      flush: false\n    });\n  };\n  /**\n   * Commit the explicit transaction.\n   * @param {Object} param\n   * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n   * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n   * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n   * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n   * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n   */\n\n\n  BoltProtocol.prototype.commitTransaction = function (_a) {\n    var _b = _a === void 0 ? {} : _a,\n        beforeError = _b.beforeError,\n        afterError = _b.afterError,\n        beforeComplete = _b.beforeComplete,\n        afterComplete = _b.afterComplete; // WRITE access mode is used as a place holder here, it has\n    // no effect on behaviour for Bolt V1 & V2\n\n\n    return this.run('COMMIT', {}, {\n      bookmarks: Bookmarks.empty(),\n      txConfig: TxConfig.empty(),\n      mode: ACCESS_MODE_WRITE,\n      beforeError: beforeError,\n      afterError: afterError,\n      beforeComplete: beforeComplete,\n      afterComplete: afterComplete\n    });\n  };\n  /**\n   * Rollback the explicit transaction.\n   * @param {Object} param\n   * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n   * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n   * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n   * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n   * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n   */\n\n\n  BoltProtocol.prototype.rollbackTransaction = function (_a) {\n    var _b = _a === void 0 ? {} : _a,\n        beforeError = _b.beforeError,\n        afterError = _b.afterError,\n        beforeComplete = _b.beforeComplete,\n        afterComplete = _b.afterComplete; // WRITE access mode is used as a place holder here, it has\n    // no effect on behaviour for Bolt V1 & V2\n\n\n    return this.run('ROLLBACK', {}, {\n      bookmarks: Bookmarks.empty(),\n      txConfig: TxConfig.empty(),\n      mode: ACCESS_MODE_WRITE,\n      beforeError: beforeError,\n      afterError: afterError,\n      beforeComplete: beforeComplete,\n      afterComplete: afterComplete\n    });\n  };\n  /**\n   * Send a Cypher query through the underlying connection.\n   * @param {string} query the cypher query.\n   * @param {Object} parameters the query parameters.\n   * @param {Object} param\n   * @param {Bookmarks} param.bookmarks the bookmarks.\n   * @param {TxConfig} param.txConfig the transaction configuration.\n   * @param {string} param.database the target database name.\n   * @param {string} param.impersonatedUser the impersonated user\n   * @param {NotificationFilter} param.notificationFilter the notification filter.\n   * @param {string} param.mode the access mode.\n   * @param {function(keys: string[])} param.beforeKeys the callback to invoke before handling the keys.\n   * @param {function(keys: string[])} param.afterKeys the callback to invoke after handling the keys.\n   * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n   * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n   * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n   * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n   * @param {boolean} param.flush whether to flush the buffered messages.\n   * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n   */\n\n\n  BoltProtocol.prototype.run = function (query, parameters, _a) {\n    var _b = _a === void 0 ? {} : _a,\n        bookmarks = _b.bookmarks,\n        txConfig = _b.txConfig,\n        database = _b.database,\n        mode = _b.mode,\n        impersonatedUser = _b.impersonatedUser,\n        notificationFilter = _b.notificationFilter,\n        beforeKeys = _b.beforeKeys,\n        afterKeys = _b.afterKeys,\n        beforeError = _b.beforeError,\n        afterError = _b.afterError,\n        beforeComplete = _b.beforeComplete,\n        afterComplete = _b.afterComplete,\n        _c = _b.flush,\n        flush = _c === void 0 ? true : _c,\n        _d = _b.highRecordWatermark,\n        highRecordWatermark = _d === void 0 ? Number.MAX_VALUE : _d,\n        _e = _b.lowRecordWatermark,\n        lowRecordWatermark = _e === void 0 ? Number.MAX_VALUE : _e;\n\n    var observer = new stream_observers_1.ResultStreamObserver({\n      server: this._server,\n      beforeKeys: beforeKeys,\n      afterKeys: afterKeys,\n      beforeError: beforeError,\n      afterError: afterError,\n      beforeComplete: beforeComplete,\n      afterComplete: afterComplete,\n      highRecordWatermark: highRecordWatermark,\n      lowRecordWatermark: lowRecordWatermark\n    }); // bookmarks and mode are ignored in this version of the protocol\n\n    (0, bolt_protocol_util_1.assertTxConfigIsEmpty)(txConfig, this._onProtocolError, observer); // passing in a database name on this protocol version throws an error\n\n    (0, bolt_protocol_util_1.assertDatabaseIsEmpty)(database, this._onProtocolError, observer); // passing impersonated user on this protocol version throws an error\n\n    (0, bolt_protocol_util_1.assertImpersonatedUserIsEmpty)(impersonatedUser, this._onProtocolError, observer); // passing notification filter on this protocol version throws an error\n\n    (0, bolt_protocol_util_1.assertNotificationFilterIsEmpty)(notificationFilter, this._onProtocolError, observer);\n    this.write(request_message_1.default.run(query, parameters), observer, false);\n    this.write(request_message_1.default.pullAll(), observer, flush);\n    return observer;\n  };\n\n  Object.defineProperty(BoltProtocol.prototype, \"currentFailure\", {\n    get: function () {\n      return this._responseHandler.currentFailure;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Send a RESET through the underlying connection.\n   * @param {Object} param\n   * @param {function(err: Error)} param.onError the callback to invoke on error.\n   * @param {function()} param.onComplete the callback to invoke on completion.\n   * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n   */\n\n  BoltProtocol.prototype.reset = function (_a) {\n    var _b = _a === void 0 ? {} : _a,\n        onError = _b.onError,\n        onComplete = _b.onComplete;\n\n    var observer = new stream_observers_1.ResetObserver({\n      onProtocolError: this._onProtocolError,\n      onError: onError,\n      onComplete: onComplete\n    });\n    this.write(request_message_1.default.reset(), observer, true);\n    return observer;\n  };\n  /**\n   * Send a TELEMETRY through the underlying connection.\n   *\n   * @param {object} param0 Message params\n   * @param {number} param0.api The API called\n   * @param {object} param1 Configuration and callbacks\n   * @param {function()} param1.onCompleted Called when completed\n   * @param {function()} param1.onError Called when error\n   * @return {StreamObserver} the stream observer that monitors the corresponding server response.\n   */\n\n\n  BoltProtocol.prototype.telemetry = function (_a, _b) {\n    var api = _a.api;\n\n    var _c = _b === void 0 ? {} : _b,\n        onError = _c.onError,\n        onCompleted = _c.onCompleted;\n\n    var observer = new stream_observers_1.CompletedObserver();\n\n    if (onCompleted) {\n      onCompleted();\n    }\n\n    return observer;\n  };\n\n  BoltProtocol.prototype._createPacker = function (chunker) {\n    return new packstream_1.v1.Packer(chunker);\n  };\n\n  BoltProtocol.prototype._createUnpacker = function (disableLosslessIntegers, useBigInt) {\n    return new packstream_1.v1.Unpacker(disableLosslessIntegers, useBigInt);\n  };\n  /**\n   * Write a message to the network channel.\n   * @param {RequestMessage} message the message to write.\n   * @param {StreamObserver} observer the response observer.\n   * @param {boolean} flush `true` if flush should happen after the message is written to the buffer.\n   */\n\n\n  BoltProtocol.prototype.write = function (message, observer, flush) {\n    var queued = this.queueObserverIfProtocolIsNotBroken(observer);\n\n    if (queued) {\n      if (this._log.isDebugEnabled()) {\n        this._log.debug(\"C: \".concat(message));\n      }\n\n      this._lastMessageSignature = message.signature;\n      var messageStruct = new packstream_1.structure.Structure(message.signature, message.fields);\n      this.packable(messageStruct)();\n\n      this._chunker.messageBoundary();\n\n      if (flush) {\n        this._chunker.flush();\n      }\n    }\n  };\n\n  BoltProtocol.prototype.isLastMessageLogon = function () {\n    return this._lastMessageSignature === request_message_1.SIGNATURES.HELLO || this._lastMessageSignature === request_message_1.SIGNATURES.LOGON;\n  };\n\n  BoltProtocol.prototype.isLastMessageReset = function () {\n    return this._lastMessageSignature === request_message_1.SIGNATURES.RESET;\n  };\n  /**\n   * Notifies faltal erros to the observers and mark the protocol in the fatal error state.\n   * @param {Error} error The error\n   */\n\n\n  BoltProtocol.prototype.notifyFatalError = function (error) {\n    this._fatalError = error;\n    return this._responseHandler._notifyErrorToObservers(error);\n  };\n  /**\n   * Updates the the current observer with the next one on the queue.\n   */\n\n\n  BoltProtocol.prototype.updateCurrentObserver = function () {\n    return this._responseHandler._updateCurrentObserver();\n  };\n  /**\n   * Checks if exist an ongoing observable requests\n   * @return {boolean}\n   */\n\n\n  BoltProtocol.prototype.hasOngoingObservableRequests = function () {\n    return this._responseHandler.hasOngoingObservableRequests();\n  };\n  /**\n   * Enqueue the observer if the protocol is not broken.\n   * In case it's broken, the observer will be notified about the error.\n   *\n   * @param {StreamObserver} observer The observer\n   * @returns {boolean} if it was queued\n   */\n\n\n  BoltProtocol.prototype.queueObserverIfProtocolIsNotBroken = function (observer) {\n    if (this.isBroken()) {\n      this.notifyFatalErrorToObserver(observer);\n      return false;\n    }\n\n    return this._responseHandler._queueObserver(observer);\n  };\n  /**\n   * Veritfy the protocol is not broken.\n   * @returns {boolean}\n   */\n\n\n  BoltProtocol.prototype.isBroken = function () {\n    return !!this._fatalError;\n  };\n  /**\n   * Notifies the current fatal error to the observer\n   *\n   * @param {StreamObserver} observer The observer\n   */\n\n\n  BoltProtocol.prototype.notifyFatalErrorToObserver = function (observer) {\n    if (observer && observer.onError) {\n      observer.onError(this._fatalError);\n    }\n  };\n  /**\n   * Reset current failure on the observable response handler to null.\n   */\n\n\n  BoltProtocol.prototype.resetFailure = function () {\n    this._responseHandler._resetFailure();\n  };\n\n  BoltProtocol.prototype._onLoginCompleted = function (metadata, authToken, onCompleted) {\n    this._initialized = true;\n    this._authToken = authToken;\n\n    if (metadata) {\n      var serverVersion = metadata.server;\n\n      if (!this._server.version) {\n        this._server.version = serverVersion;\n      }\n    }\n\n    if (onCompleted) {\n      onCompleted(metadata);\n    }\n  };\n\n  BoltProtocol.prototype._onLoginError = function (error, onError) {\n    this._onProtocolError(error.message);\n\n    if (onError) {\n      onError(error);\n    }\n  };\n\n  return BoltProtocol;\n}();\n\nexports.default = BoltProtocol;","map":{"version":3,"names":["__createBinding","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","prototype","hasOwnProperty","call","__importDefault","exports","bolt_protocol_util_1","require","channel_1","packstream_1","request_message_1","stream_observers_1","neo4j_driver_core_1","bolt_protocol_v1_transformer_1","transformer_1","Bookmarks","internal","bookmarks","_a","constants","ACCESS_MODE_WRITE","BOLT_PROTOCOL_V1","Logger","logger","TxConfig","txConfig","BoltProtocol","server","chunker","createResponseHandler","log","onProtocolError","_b","disableLosslessIntegers","useBigInt","_server","_chunker","_packer","_createPacker","_unpacker","_createUnpacker","_responseHandler","_log","_onProtocolError","_fatalError","_lastMessageSignature","_config","_this","_transformer","default","values","map","_initialized","_authToken","packer","packable","x","transformer","toStructure","unpacker","unpack","buf","fromStructure","transformMetadata","metadata","initialize","userAgent","boltAgent","authToken","notificationFilter","onError","onComplete","observer","LoginObserver","error","_onLoginError","onCompleted","_onLoginCompleted","assertNotificationFilterIsEmpty","write","init","logoff","flush","LogoffObserver","newError","message","logon","prepareToClose","beginTransaction","database","mode","impersonatedUser","beforeError","afterError","beforeComplete","afterComplete","run","asBeginTransactionParameters","commitTransaction","empty","rollbackTransaction","query","parameters","beforeKeys","afterKeys","_c","_d","highRecordWatermark","Number","MAX_VALUE","_e","lowRecordWatermark","ResultStreamObserver","assertTxConfigIsEmpty","assertDatabaseIsEmpty","assertImpersonatedUserIsEmpty","pullAll","currentFailure","reset","ResetObserver","telemetry","api","CompletedObserver","v1","Packer","Unpacker","queued","queueObserverIfProtocolIsNotBroken","isDebugEnabled","debug","concat","signature","messageStruct","structure","Structure","fields","messageBoundary","isLastMessageLogon","SIGNATURES","HELLO","LOGON","isLastMessageReset","RESET","notifyFatalError","_notifyErrorToObservers","updateCurrentObserver","_updateCurrentObserver","hasOngoingObservableRequests","isBroken","notifyFatalErrorToObserver","_queueObserver","resetFailure","_resetFailure","serverVersion","version"],"sources":["C:/projects/levelUp_v1/Level-Up-FN/Level-Up-Fronten-master/node_modules/neo4j-driver-bolt-connection/lib/bolt/bolt-protocol-v1.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [https://neo4j.com]\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar bolt_protocol_util_1 = require(\"./bolt-protocol-util\");\n// eslint-disable-next-line no-unused-vars\nvar channel_1 = require(\"../channel\");\nvar packstream_1 = require(\"../packstream\");\nvar request_message_1 = __importStar(require(\"./request-message\"));\nvar stream_observers_1 = require(\"./stream-observers\");\nvar neo4j_driver_core_1 = require(\"neo4j-driver-core\");\nvar bolt_protocol_v1_transformer_1 = __importDefault(require(\"./bolt-protocol-v1.transformer\"));\nvar transformer_1 = __importDefault(require(\"./transformer\"));\nvar Bookmarks = neo4j_driver_core_1.internal.bookmarks.Bookmarks, _a = neo4j_driver_core_1.internal.constants, ACCESS_MODE_WRITE = _a.ACCESS_MODE_WRITE, BOLT_PROTOCOL_V1 = _a.BOLT_PROTOCOL_V1, Logger = neo4j_driver_core_1.internal.logger.Logger, TxConfig = neo4j_driver_core_1.internal.txConfig.TxConfig;\nvar BoltProtocol = /** @class */ (function () {\n    /**\n     * @callback CreateResponseHandler Creates the response handler\n     * @param {BoltProtocol} protocol The bolt protocol\n     * @returns {ResponseHandler} The response handler\n     */\n    /**\n     * @callback OnProtocolError Handles protocol error\n     * @param {string} error The description\n     */\n    /**\n     * @constructor\n     * @param {Object} server the server informatio.\n     * @param {Chunker} chunker the chunker.\n     * @param {Object} packstreamConfig Packstream configuration\n     * @param {boolean} packstreamConfig.disableLosslessIntegers if this connection should convert all received integers to native JS numbers.\n     * @param {boolean} packstreamConfig.useBigInt if this connection should convert all received integers to native BigInt numbers.\n     * @param {CreateResponseHandler} createResponseHandler Function which creates the response handler\n     * @param {Logger} log the logger\n     * @param {OnProtocolError} onProtocolError handles protocol errors\n     */\n    function BoltProtocol(server, chunker, _a, createResponseHandler, log, onProtocolError) {\n        var _b = _a === void 0 ? {} : _a, disableLosslessIntegers = _b.disableLosslessIntegers, useBigInt = _b.useBigInt;\n        if (createResponseHandler === void 0) { createResponseHandler = function () { return null; }; }\n        this._server = server || {};\n        this._chunker = chunker;\n        this._packer = this._createPacker(chunker);\n        this._unpacker = this._createUnpacker(disableLosslessIntegers, useBigInt);\n        this._responseHandler = createResponseHandler(this);\n        this._log = log;\n        this._onProtocolError = onProtocolError;\n        this._fatalError = null;\n        this._lastMessageSignature = null;\n        this._config = { disableLosslessIntegers: disableLosslessIntegers, useBigInt: useBigInt };\n    }\n    Object.defineProperty(BoltProtocol.prototype, \"transformer\", {\n        get: function () {\n            var _this = this;\n            if (this._transformer === undefined) {\n                this._transformer = new transformer_1.default(Object.values(bolt_protocol_v1_transformer_1.default).map(function (create) { return create(_this._config, _this._log); }));\n            }\n            return this._transformer;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BoltProtocol.prototype, \"version\", {\n        /**\n         * Returns the numerical version identifier for this protocol\n         */\n        get: function () {\n            return BOLT_PROTOCOL_V1;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BoltProtocol.prototype, \"supportsReAuth\", {\n        /**\n         * @property {boolean} supportsReAuth Either if the protocol version supports re-auth or not.\n         */\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BoltProtocol.prototype, \"initialized\", {\n        /**\n         * @property {boolean} initialized Either if the protocol was initialized or not\n         */\n        get: function () {\n            return !!this._initialized;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BoltProtocol.prototype, \"authToken\", {\n        /**\n         * @property {object} authToken The token used in the last login\n         */\n        get: function () {\n            return this._authToken;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Get the packer.\n     * @return {Packer} the protocol's packer.\n     */\n    BoltProtocol.prototype.packer = function () {\n        return this._packer;\n    };\n    /**\n     * Creates a packable function out of the provided value\n     * @param x the value to pack\n     * @returns Function\n     */\n    BoltProtocol.prototype.packable = function (x) {\n        return this._packer.packable(x, this.transformer.toStructure);\n    };\n    /**\n     * Get the unpacker.\n     * @return {Unpacker} the protocol's unpacker.\n     */\n    BoltProtocol.prototype.unpacker = function () {\n        return this._unpacker;\n    };\n    /**\n     * Unpack a buffer\n     * @param {Buffer} buf\n     * @returns {any|null} The unpacked value\n     */\n    BoltProtocol.prototype.unpack = function (buf) {\n        return this._unpacker.unpack(buf, this.transformer.fromStructure);\n    };\n    /**\n     * Transform metadata received in SUCCESS message before it is passed to the handler.\n     * @param {Object} metadata the received metadata.\n     * @return {Object} transformed metadata.\n     */\n    BoltProtocol.prototype.transformMetadata = function (metadata) {\n        return metadata;\n    };\n    /**\n     * Perform initialization and authentication of the underlying connection.\n     * @param {Object} param\n     * @param {string} param.userAgent the user agent.\n     * @param {Object} param.authToken the authentication token.\n     * @param {NotificationFilter} param.notificationFilter the notification filter.\n     * @param {function(err: Error)} param.onError the callback to invoke on error.\n     * @param {function()} param.onComplete the callback to invoke on completion.\n     * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n     */\n    BoltProtocol.prototype.initialize = function (_a) {\n        var _this = this;\n        var _b = _a === void 0 ? {} : _a, userAgent = _b.userAgent, boltAgent = _b.boltAgent, authToken = _b.authToken, notificationFilter = _b.notificationFilter, onError = _b.onError, onComplete = _b.onComplete;\n        var observer = new stream_observers_1.LoginObserver({\n            onError: function (error) { return _this._onLoginError(error, onError); },\n            onCompleted: function (metadata) { return _this._onLoginCompleted(metadata, onComplete); }\n        });\n        // passing notification filter on this protocol version throws an error\n        (0, bolt_protocol_util_1.assertNotificationFilterIsEmpty)(notificationFilter, this._onProtocolError, observer);\n        this.write(request_message_1.default.init(userAgent, authToken), observer, true);\n        return observer;\n    };\n    /**\n     * Performs logoff of the underlying connection\n     *\n     * @param {Object} param\n     * @param {function(err: Error)} param.onError the callback to invoke on error.\n     * @param {function()} param.onComplete the callback to invoke on completion.\n     * @param {boolean} param.flush whether to flush the buffered messages.\n     *\n     * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n     */\n    BoltProtocol.prototype.logoff = function (_a) {\n        var _b = _a === void 0 ? {} : _a, onComplete = _b.onComplete, onError = _b.onError, flush = _b.flush;\n        var observer = new stream_observers_1.LogoffObserver({\n            onCompleted: onComplete,\n            onError: onError\n        });\n        // TODO: Verify the Neo4j version in the message\n        var error = (0, neo4j_driver_core_1.newError)('Driver is connected to a database that does not support logoff. ' +\n            'Please upgrade to Neo4j 5.5.0 or later in order to use this functionality.');\n        // unsupported API was used, consider this a fatal error for the current connection\n        this._onProtocolError(error.message);\n        observer.onError(error);\n        throw error;\n    };\n    /**\n     * Performs login of the underlying connection\n     *\n     * @param {Object} args\n     * @param {Object} args.authToken the authentication token.\n     * @param {function(err: Error)} args.onError the callback to invoke on error.\n     * @param {function()} args.onComplete the callback to invoke on completion.\n     * @param {boolean} args.flush whether to flush the buffered messages.\n     *\n     * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n     */\n    BoltProtocol.prototype.logon = function (_a) {\n        var _this = this;\n        var _b = _a === void 0 ? {} : _a, authToken = _b.authToken, onComplete = _b.onComplete, onError = _b.onError, flush = _b.flush;\n        var observer = new stream_observers_1.LoginObserver({\n            onCompleted: function () { return _this._onLoginCompleted({}, authToken, onComplete); },\n            onError: function (error) { return _this._onLoginError(error, onError); }\n        });\n        // TODO: Verify the Neo4j version in the message\n        var error = (0, neo4j_driver_core_1.newError)('Driver is connected to a database that does not support logon. ' +\n            'Please upgrade to Neo4j 5.5.0 or later in order to use this functionality.');\n        // unsupported API was used, consider this a fatal error for the current connection\n        this._onProtocolError(error.message);\n        observer.onError(error);\n        throw error;\n    };\n    /**\n     * Perform protocol related operations for closing this connection\n     */\n    BoltProtocol.prototype.prepareToClose = function () {\n        // no need to notify the database in this protocol version\n    };\n    /**\n     * Begin an explicit transaction.\n     * @param {Object} param\n     * @param {Bookmarks} param.bookmarks the bookmarks.\n     * @param {TxConfig} param.txConfig the configuration.\n     * @param {string} param.database the target database name.\n     * @param {string} param.mode the access mode.\n     * @param {string} param.impersonatedUser the impersonated user\n     * @param {NotificationFilter} param.notificationFilter the notification filter.\n     * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n     * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n     * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n     * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n     * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n     */\n    BoltProtocol.prototype.beginTransaction = function (_a) {\n        var _b = _a === void 0 ? {} : _a, bookmarks = _b.bookmarks, txConfig = _b.txConfig, database = _b.database, mode = _b.mode, impersonatedUser = _b.impersonatedUser, notificationFilter = _b.notificationFilter, beforeError = _b.beforeError, afterError = _b.afterError, beforeComplete = _b.beforeComplete, afterComplete = _b.afterComplete;\n        return this.run('BEGIN', bookmarks ? bookmarks.asBeginTransactionParameters() : {}, {\n            bookmarks: bookmarks,\n            txConfig: txConfig,\n            database: database,\n            mode: mode,\n            impersonatedUser: impersonatedUser,\n            notificationFilter: notificationFilter,\n            beforeError: beforeError,\n            afterError: afterError,\n            beforeComplete: beforeComplete,\n            afterComplete: afterComplete,\n            flush: false\n        });\n    };\n    /**\n     * Commit the explicit transaction.\n     * @param {Object} param\n     * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n     * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n     * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n     * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n     * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n     */\n    BoltProtocol.prototype.commitTransaction = function (_a) {\n        var _b = _a === void 0 ? {} : _a, beforeError = _b.beforeError, afterError = _b.afterError, beforeComplete = _b.beforeComplete, afterComplete = _b.afterComplete;\n        // WRITE access mode is used as a place holder here, it has\n        // no effect on behaviour for Bolt V1 & V2\n        return this.run('COMMIT', {}, {\n            bookmarks: Bookmarks.empty(),\n            txConfig: TxConfig.empty(),\n            mode: ACCESS_MODE_WRITE,\n            beforeError: beforeError,\n            afterError: afterError,\n            beforeComplete: beforeComplete,\n            afterComplete: afterComplete\n        });\n    };\n    /**\n     * Rollback the explicit transaction.\n     * @param {Object} param\n     * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n     * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n     * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n     * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n     * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n     */\n    BoltProtocol.prototype.rollbackTransaction = function (_a) {\n        var _b = _a === void 0 ? {} : _a, beforeError = _b.beforeError, afterError = _b.afterError, beforeComplete = _b.beforeComplete, afterComplete = _b.afterComplete;\n        // WRITE access mode is used as a place holder here, it has\n        // no effect on behaviour for Bolt V1 & V2\n        return this.run('ROLLBACK', {}, {\n            bookmarks: Bookmarks.empty(),\n            txConfig: TxConfig.empty(),\n            mode: ACCESS_MODE_WRITE,\n            beforeError: beforeError,\n            afterError: afterError,\n            beforeComplete: beforeComplete,\n            afterComplete: afterComplete\n        });\n    };\n    /**\n     * Send a Cypher query through the underlying connection.\n     * @param {string} query the cypher query.\n     * @param {Object} parameters the query parameters.\n     * @param {Object} param\n     * @param {Bookmarks} param.bookmarks the bookmarks.\n     * @param {TxConfig} param.txConfig the transaction configuration.\n     * @param {string} param.database the target database name.\n     * @param {string} param.impersonatedUser the impersonated user\n     * @param {NotificationFilter} param.notificationFilter the notification filter.\n     * @param {string} param.mode the access mode.\n     * @param {function(keys: string[])} param.beforeKeys the callback to invoke before handling the keys.\n     * @param {function(keys: string[])} param.afterKeys the callback to invoke after handling the keys.\n     * @param {function(err: Error)} param.beforeError the callback to invoke before handling the error.\n     * @param {function(err: Error)} param.afterError the callback to invoke after handling the error.\n     * @param {function()} param.beforeComplete the callback to invoke before handling the completion.\n     * @param {function()} param.afterComplete the callback to invoke after handling the completion.\n     * @param {boolean} param.flush whether to flush the buffered messages.\n     * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n     */\n    BoltProtocol.prototype.run = function (query, parameters, _a) {\n        var _b = _a === void 0 ? {} : _a, bookmarks = _b.bookmarks, txConfig = _b.txConfig, database = _b.database, mode = _b.mode, impersonatedUser = _b.impersonatedUser, notificationFilter = _b.notificationFilter, beforeKeys = _b.beforeKeys, afterKeys = _b.afterKeys, beforeError = _b.beforeError, afterError = _b.afterError, beforeComplete = _b.beforeComplete, afterComplete = _b.afterComplete, _c = _b.flush, flush = _c === void 0 ? true : _c, _d = _b.highRecordWatermark, highRecordWatermark = _d === void 0 ? Number.MAX_VALUE : _d, _e = _b.lowRecordWatermark, lowRecordWatermark = _e === void 0 ? Number.MAX_VALUE : _e;\n        var observer = new stream_observers_1.ResultStreamObserver({\n            server: this._server,\n            beforeKeys: beforeKeys,\n            afterKeys: afterKeys,\n            beforeError: beforeError,\n            afterError: afterError,\n            beforeComplete: beforeComplete,\n            afterComplete: afterComplete,\n            highRecordWatermark: highRecordWatermark,\n            lowRecordWatermark: lowRecordWatermark\n        });\n        // bookmarks and mode are ignored in this version of the protocol\n        (0, bolt_protocol_util_1.assertTxConfigIsEmpty)(txConfig, this._onProtocolError, observer);\n        // passing in a database name on this protocol version throws an error\n        (0, bolt_protocol_util_1.assertDatabaseIsEmpty)(database, this._onProtocolError, observer);\n        // passing impersonated user on this protocol version throws an error\n        (0, bolt_protocol_util_1.assertImpersonatedUserIsEmpty)(impersonatedUser, this._onProtocolError, observer);\n        // passing notification filter on this protocol version throws an error\n        (0, bolt_protocol_util_1.assertNotificationFilterIsEmpty)(notificationFilter, this._onProtocolError, observer);\n        this.write(request_message_1.default.run(query, parameters), observer, false);\n        this.write(request_message_1.default.pullAll(), observer, flush);\n        return observer;\n    };\n    Object.defineProperty(BoltProtocol.prototype, \"currentFailure\", {\n        get: function () {\n            return this._responseHandler.currentFailure;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Send a RESET through the underlying connection.\n     * @param {Object} param\n     * @param {function(err: Error)} param.onError the callback to invoke on error.\n     * @param {function()} param.onComplete the callback to invoke on completion.\n     * @returns {StreamObserver} the stream observer that monitors the corresponding server response.\n     */\n    BoltProtocol.prototype.reset = function (_a) {\n        var _b = _a === void 0 ? {} : _a, onError = _b.onError, onComplete = _b.onComplete;\n        var observer = new stream_observers_1.ResetObserver({\n            onProtocolError: this._onProtocolError,\n            onError: onError,\n            onComplete: onComplete\n        });\n        this.write(request_message_1.default.reset(), observer, true);\n        return observer;\n    };\n    /**\n     * Send a TELEMETRY through the underlying connection.\n     *\n     * @param {object} param0 Message params\n     * @param {number} param0.api The API called\n     * @param {object} param1 Configuration and callbacks\n     * @param {function()} param1.onCompleted Called when completed\n     * @param {function()} param1.onError Called when error\n     * @return {StreamObserver} the stream observer that monitors the corresponding server response.\n     */\n    BoltProtocol.prototype.telemetry = function (_a, _b) {\n        var api = _a.api;\n        var _c = _b === void 0 ? {} : _b, onError = _c.onError, onCompleted = _c.onCompleted;\n        var observer = new stream_observers_1.CompletedObserver();\n        if (onCompleted) {\n            onCompleted();\n        }\n        return observer;\n    };\n    BoltProtocol.prototype._createPacker = function (chunker) {\n        return new packstream_1.v1.Packer(chunker);\n    };\n    BoltProtocol.prototype._createUnpacker = function (disableLosslessIntegers, useBigInt) {\n        return new packstream_1.v1.Unpacker(disableLosslessIntegers, useBigInt);\n    };\n    /**\n     * Write a message to the network channel.\n     * @param {RequestMessage} message the message to write.\n     * @param {StreamObserver} observer the response observer.\n     * @param {boolean} flush `true` if flush should happen after the message is written to the buffer.\n     */\n    BoltProtocol.prototype.write = function (message, observer, flush) {\n        var queued = this.queueObserverIfProtocolIsNotBroken(observer);\n        if (queued) {\n            if (this._log.isDebugEnabled()) {\n                this._log.debug(\"C: \".concat(message));\n            }\n            this._lastMessageSignature = message.signature;\n            var messageStruct = new packstream_1.structure.Structure(message.signature, message.fields);\n            this.packable(messageStruct)();\n            this._chunker.messageBoundary();\n            if (flush) {\n                this._chunker.flush();\n            }\n        }\n    };\n    BoltProtocol.prototype.isLastMessageLogon = function () {\n        return this._lastMessageSignature === request_message_1.SIGNATURES.HELLO ||\n            this._lastMessageSignature === request_message_1.SIGNATURES.LOGON;\n    };\n    BoltProtocol.prototype.isLastMessageReset = function () {\n        return this._lastMessageSignature === request_message_1.SIGNATURES.RESET;\n    };\n    /**\n     * Notifies faltal erros to the observers and mark the protocol in the fatal error state.\n     * @param {Error} error The error\n     */\n    BoltProtocol.prototype.notifyFatalError = function (error) {\n        this._fatalError = error;\n        return this._responseHandler._notifyErrorToObservers(error);\n    };\n    /**\n     * Updates the the current observer with the next one on the queue.\n     */\n    BoltProtocol.prototype.updateCurrentObserver = function () {\n        return this._responseHandler._updateCurrentObserver();\n    };\n    /**\n     * Checks if exist an ongoing observable requests\n     * @return {boolean}\n     */\n    BoltProtocol.prototype.hasOngoingObservableRequests = function () {\n        return this._responseHandler.hasOngoingObservableRequests();\n    };\n    /**\n     * Enqueue the observer if the protocol is not broken.\n     * In case it's broken, the observer will be notified about the error.\n     *\n     * @param {StreamObserver} observer The observer\n     * @returns {boolean} if it was queued\n     */\n    BoltProtocol.prototype.queueObserverIfProtocolIsNotBroken = function (observer) {\n        if (this.isBroken()) {\n            this.notifyFatalErrorToObserver(observer);\n            return false;\n        }\n        return this._responseHandler._queueObserver(observer);\n    };\n    /**\n     * Veritfy the protocol is not broken.\n     * @returns {boolean}\n     */\n    BoltProtocol.prototype.isBroken = function () {\n        return !!this._fatalError;\n    };\n    /**\n     * Notifies the current fatal error to the observer\n     *\n     * @param {StreamObserver} observer The observer\n     */\n    BoltProtocol.prototype.notifyFatalErrorToObserver = function (observer) {\n        if (observer && observer.onError) {\n            observer.onError(this._fatalError);\n        }\n    };\n    /**\n     * Reset current failure on the observable response handler to null.\n     */\n    BoltProtocol.prototype.resetFailure = function () {\n        this._responseHandler._resetFailure();\n    };\n    BoltProtocol.prototype._onLoginCompleted = function (metadata, authToken, onCompleted) {\n        this._initialized = true;\n        this._authToken = authToken;\n        if (metadata) {\n            var serverVersion = metadata.server;\n            if (!this._server.version) {\n                this._server.version = serverVersion;\n            }\n        }\n        if (onCompleted) {\n            onCompleted(metadata);\n        }\n    };\n    BoltProtocol.prototype._onLoginError = function (error, onError) {\n        this._onProtocolError(error.message);\n        if (onError) {\n            onError(error);\n        }\n    };\n    return BoltProtocol;\n}());\nexports.default = BoltProtocol;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}